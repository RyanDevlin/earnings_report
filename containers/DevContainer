FROM docker.io/library/golang AS buildStage

# Pull down the code and cd into it
RUN go get -d -v github.com/tkobil/earnings_report/... 
WORKDIR /go/src/github.com/tkobil/earnings_report

# Compile the application
RUN CGO_ENABLED=0 GOOS=linux GOARCH=arm go build -a -installsuffix cgo -o earningsbot cmd/runearningsreport.go

# Build final image
FROM docker.io/library/debian

# Curl has to be installed for the networking in the app to work
# No idea why. We probably need to hunt down the specific packages
# missing from the debian image that curl and our app both use.
RUN apt-get update && apt-get install -y curl
WORKDIR /root/
COPY --from=buildStage /go/src/github.com/tkobil/earnings_report/earningsbot .

# Expose metadata to explain that these ports are used by the application
EXPOSE 80 443
